{"version":3,"sources":["../../../src/modules/download/downloadIcon.js"],"names":[],"mappings":";;AAAA,IAAM,QAAQ,QAAQ,OAAR,CAAR;AACN,IAAM,MAAM,QAAQ,KAAR,CAAN;AACN,IAAM,WAAW,QAAQ,WAAR,CAAX;;AAEN,SAAS,YAAT,CAAsB,WAAtB,EAAmC;AAC/B,WAAO,YAAY,KAAZ,CAAkB,iBAAlB,EAAqC,CAArC,CAAP,CAD+B;CAAnC;;AAIA,SAAS,aAAT,CAAuB,OAAvB,EAAgC;AAC5B,WAAO,IAAI,KAAJ,CAAU,OAAV,EAAmB,QAAnB,CADqB;CAAhC;;AAIA,SAAS,YAAT,CAAsB,OAAtB,EAA+B;AAC3B,QAAM,WAAW,IAAI,OAAJ,CAAY,UAAS,OAAT,EAAkB,MAAlB,EAA0B;AACnD,cAAM,GAAN,CAAU,OAAV,EAAmB;AACf,0BAAc,aAAd;SADJ;AAIK,YAJL,CAIU,UAAS,QAAT,EAAmB;AACrB,oBAAQ,SAAS,IAAT,CAAR,CADqB;SAAnB,CAJV,CAOK,KAPL,CAOW,UAAS,KAAT,EAAgB;AACnB,gBAAI,MAAM,MAAN,KAAiB,GAAjB,EAAsB;AACtB,0BADsB;AAEtB,uBAFsB;aAA1B;AAIA,mBAAO,KAAP,EALmB;SAAhB,CAPX,CADmD;KAA1B,CAAvB,CADqB;;AAkB3B,WAAO,SAAS,IAAT,CAAc,oBAAY;AAC7B,YAAI,CAAC,QAAD,EAAW;AACX,mBADW;SAAf;;AAIA,YAAM,cAAc,SAAS,QAAT,CAAd,CALuB;AAM7B,YAAI,CAAC,WAAD,EAAc;AACd,mBAAO,IAAP,CADc;SAAlB;;;AAN6B,mBAW7B,CAAY,GAAZ,SAAsB,YAAY,GAAZ,CAXO;;AAa7B,eAAO,OAAO,MAAP,CAAc;AACjB,oBAAQ,OAAR;AACA,kBAAM,cAAc,OAAd,CAAN;AACA,kBAAM,QAAN;AACA,kBAAM,SAAS,MAAT;SAJH,EAKJ,WALI,CAAP,CAb6B;KAAZ,CAArB,CAlB2B;CAA/B;;AAwCA,OAAO,OAAP,GAAiB,YAAjB","file":"downloadIcon.js","sourcesContent":["const axios = require('axios');\nconst url = require('url');\nconst fileType = require('file-type');\n\nfunction getExtension(downloadUrl) {\n    return downloadUrl.match(/\\.(png|jpg|ico)/)[0];\n}\n\nfunction getSiteDomain(siteUrl) {\n    return url.parse(siteUrl).hostname;\n}\n\nfunction downloadIcon(iconUrl) {\n    const iconData = new Promise(function(resolve, reject) {\n        axios.get(iconUrl, {\n            responseType: 'arraybuffer',\n            //'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/48.0.2564.116 Safari/537.36'\n        })\n            .then(function(response) {\n                resolve(response.data);\n            })\n            .catch(function(error) {\n                if (error.status === 404) {\n                    resolve();\n                    return;\n                }\n                reject(error);\n            });\n    });\n\n    return iconData.then(iconData => {\n        if (!iconData) {\n            return;\n        }\n\n        const fileDetails = fileType(iconData);\n        if (!fileDetails) {\n            return null;\n        }\n\n        // add `.` to ext\n        fileDetails.ext = `.${fileDetails.ext}`;\n\n        return Object.assign({\n            source: iconUrl,\n            name: getSiteDomain(iconUrl),\n            data: iconData,\n            size: iconData.length\n        }, fileDetails);\n    });\n}\n\nmodule.exports = downloadIcon;\n"]}