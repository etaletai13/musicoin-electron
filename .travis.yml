jobs:
  include:
  - stage: build
    language: node_js
    node_js: 8.0.0
    os: osx
    yarn: 1.5.0
    before_install:
    - brew update
    - brew install wine
    script:
    - git config credential.helper "store --file=.git/credentials"
    - echo "https://${GH_TOKEN}:@github.com" > .git/credentials
    - "yarn darwin"
    - echo "OSX built"
    - "yarn linux"
    - echo "Linux built"
    - "yarn windows"
    - echo "Adding files back"
    - git add -A
    - git commit -am "v1.0.0-${TRAVIS_BUILD_NUMBER}"
    - git checkout release
    - git merge staging
    - git push origin release -f
    - echo "Woohoo"
  - stage: Deploy to Github
    deploy:
      provider: releases
      api_key: ${GH_TOKEN}
      file: "./dist/*"
      skip_cleanup: true
      on:
        repo: etaletai13/musicoin-electron
        branches:
          only: release
